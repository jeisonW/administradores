{% extends "layout.html" %}

{% block title %}
    proovedor
{% endblock %}

{% block main %}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">


<style>
    /* Estilos del Navbar */
    .navbar1 {
      background-color: #f6f6f6;
      overflow: hidden;
    }
  
    .navbar1 a {
      float: right;
      color: rgb(0, 0, 0);
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
    }
  
    .navbar1 a:hover {
      color: rgb(255, 0, 0);
    }
  
    .navbar1 .left-content {
      float: left;
    }
  
   
  
  
    </style>
  <link rel="stylesheet" href="static/css/button.css">
  
  
  <section class="p-4 my-container">
    
    <div class="navbar1">
        <div class="left-content">
            <button  type="submit" class="btn prueba btn-primary mb-4" id="menu-btn">
                <i class="fas fa-bars"></i> Menú
            </button>
        </div>
        <a href="/logout"> 
                <i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesión
        </a>  
        {% if session["user_id"][0][1] == 'admin' %}
  
        <a href="/edituser"> Usuarios </a>
        {% endif %}
  
      </div>  
   <!--
    <div class="form-group text-center">
        <input type="text" id="search" class="form-control mx-auto custom-border" onkeyup="filter()" placeholder="Buscar..." >
    </div>

    <table class="table table-dark table-striped">
    <thead>
        <tr>
            <th scope="col">id</th>
            <th scope="col">Nombre</th>
            <th scope="col">Correo</th>
            <th scope="col">Telefono</th>
            <th scope="col">Dirreccion</th>
            <th scope="col"></th>

        </tr>
        </thead>
        <tbody class="tres">
        {% for row in datos %}
        <tr>
            <td class="title">{{row.IDproveedor }}</td>
            <td class="title1">{{row.Nombreproveedor}}</td>
            <td class="title2">{{row.Correo}}</td>
            <td class="title3">{{row.Telefono}}</td>
            <td class="title4">{{row.Dirreccion}}</td>
            <td>  <a href="#" class="btn btn-primary btn-sm editar_proveedor" data-IDproveedor="{{row.IDproveedor}}" data-NombreProveedor="{{row.Nombreproveedor}}" data-Correo="{{row.Correo}}" data-Telefono="{{row.Telefono}}" data-Dirreccion="{{row.Dirreccion}}" ><i class="fas fa-pencil"></i></a>
                {% if session["user_id"][0][1] == 'admin' %}

                <a  href="#" class="btn btn-danger btn-sm eliminar-proveedor" data-idpro="{{row.IDproveedor}}" ><i class="fa fa-trash"></i></a></td>
                {% endif %}
        </tr>
        {% endfor %}
    </table>
--> 
<div class="form-group text-center">
    <input type="text" id="search" class="form-control mx-auto custom-border" onkeyup="filter()" placeholder="Buscar..." >
    <button type="button" class="btn btn-primary add-proveedor" >
        Registrar nuevo Proveedor 
    </button>

</div>

<table class="table table-dark table-striped">
<thead>
    <tr>
        <th scope="col">id</th>
        <th scope="col">Nombre</th>
        <th scope="col">Correo</th>
        <th scope="col">Telefono</th>
        <th scope="col">Dirreccion</th>
        <th scope="col"></th>

    </tr>
    </thead>
    <tbody class="tres">
    {% for row in datos %}
    <tr>
        <td class="title">{{row.IDproveedor }}</td>
        <td class="title1">{{row.Nombreproveedor}}</td>
        <td class="title2">{{row.Correo}}</td>
        <td class="title3">
            {{row.Telefono}}
            
        </td>
        <td class="title4">{{row.Dirreccion}}</td>
        <td>  <a href="#" class="btn btn-primary btn-sm editar_proveedor" data-IDproveedor="{{row.IDproveedor}}" data-NombreProveedor="{{row.Nombreproveedor}}" data-Correo="{{row.Correo}}" data-Telefono="{{row.Telefono}}" data-Dirreccion="{{row.Dirreccion}}" ><i class="fas fa-pencil"></i></a>
            {% if session["user_id"][0][1] == 'admin' %}
            <a  href="#" class="btn btn-danger btn-sm eliminar-proveedor" data-idpro="{{row.IDproveedor}}" ><i class="fa-solid fa-user-minus"></i></a></td>
            {% endif %}
    </tr>
    {% endfor %}
</table>


<form action="/agregarproveedor" method="post"  >
    <div id="addpro" class="modal fade " tabindex="-1" role="dialog" aria-labelledby="editarModalLabel" aria-hidden="true">
        <div class="modal-dialog ">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editarModalLabel">Registrar Proveedor</h5>
                    <button type="button" class="close ocultar" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="form-group">
                        <label for="Nombreproveedor">Nombre</label>
                        <input type="text" class="form-control" name="nombre" pattern="[a-zA-Z\s]+" title="No se aceptan datos numericos" required >
                    </div>
                    <div class="form-group">
                        <label for="Correo">Correo </label>
                        <input type="email" class="form-control" name="correo" pattern=".*gmail.com$" required>
                    </div>
                    <div class="form-group">
                        <label for="Telefono">Telefono</label>
                        <input type="tel" class="form-control"  placeholder="formato (########)" name="Telefono" min="0" minlength="8" title="Ingresa solo números y debe tener 8 dígitos" required pattern="[0-9]{8}">

                    </div>
                    <div class="form-group">
                        <label for="Dirreccion">Dirección</label>
                        <input type="text" class="form-control"  name="Dirreccion" required>
                    </div>
                   
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary guardar-cambios">Guardar</button>
                    <button type="button" class="btn btn-secondary ocultar" data-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
</form>

    <!-- Ventana modal -->
    <form action="/editProveedor" method="post"  enctype="multipart/form-data">
        <div id="editarModal" class="modal fade " tabindex="-1" role="dialog" aria-labelledby="editarModalLabel" aria-hidden="true">
            <div class="modal-dialog ">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editarModalLabel">Editar Proveedor</h5>
                        <button type="button" class="close ocultar" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <div class="modal-body">
                        <input type="hidden" id="proveedor" name="id">
                        <div class="form-group">
                            <label for="Nombreproveedor">Nombre</label>
                            <input type="text" class="form-control" id="Nombreproveedor" name="nombre" required  pattern="[a-zA-Z\s]+" title="No se aceptan datos numericos" >
                        </div>
                        <div class="form-group">
                            <label for="Correo">Correo </label>
                            <input type="text" class="form-control" id="Correo" name="correo" pattern=".*gmail.com$" required>
                        </div>
                        <div class="form-group">
                            <label for="Telefono">Telefono</label>
                            <input type="tel" id="Telefono" class="form-control" placeholder="formato (########)" name="Telefono" min="0" minlength="8" title="Ingresa solo números y debe tener 8 dígitos" required pattern="[0-9]{8}">
                        </div>
                        <div class="form-group">
                            <label for="Dirreccion">Dirección</label>
                            <input type="text" class="form-control" id="Dirreccion" name="Dirreccion" required>
                        </div>
                       
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary guardar-cambios">Guardar</button>
                        <button type="button" class="btn btn-secondary ocultar" data-dismiss="modal">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <form action="/eliminarproveedor" method="post" id="deleteForm">
        <input type="hidden" id="ideli" name="idhiddenform">    
        <input type="hidden" name="tabla" >
    </form>
    


    
</section>

  
<script src="/static/js/navbar.js"></script>


<!--js bootstraps-->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!--No borrar scrip para que funcione el dropdown-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


<!--js propio-->
<script>

    var deletepro = "{{ pro }}";
    
    // Verifica si hay un mensaje de error y muestra la modal correspondiente
    if (deletepro == 'Proveedor Eliminado!') 
    {
      Swal.fire({
        position: 'center',
        icon: 'success',
        title:deletepro,
        showConfirmButton: false,
        timer: 2000
      })
    }


    var addpro = "{{ addpro }}";
    
    // Verifica si hay un mensaje de error y muestra la modal correspondiente
    if (addpro == 'Proveedor Registrado!') {
      Swal.fire({
        position: 'center',
        icon: 'success',
        title:addpro,
        showConfirmButton: false,
        timer: 2000
      })
    }

    $(document).ready(function() {

    $('.editar_proveedor').click(function() {
        var id = $(this).data('idproveedor');
        var nombre = $(this).data('nombreproveedor');
        var correo = $(this).data('correo');
        var telefono = $(this).data('telefono'); 
        var direc = $(this).data('dirreccion');
      
         // Llenar los campos de la ventana modal con los datos del empleado
        $('#proveedor').val(id);
        $('#Nombreproveedor').val(nombre);
        $('#Correo').val(correo);
        $('#Telefono').val(telefono);
        $('#Dirreccion').val(direc);

      // Mostrar la ventana modal
      $('#editarModal').modal('show');
    });

    $('.ocultar').click(function() {
        $('#editarModal').modal('hide');
      });

      $('.add-proveedor').click(function() {
       
      // Mostrar la ventana modal
      $('#addpro').modal('show');
    });

    $('.ocultar').click(function() {
        $('#addpro').modal('hide');
      });
    
});

function filter() {
    var input, filter, tbody, td, i;
    input = document.getElementById("search");
    filter = input.value.toUpperCase();
    tbody = document.querySelector(".table");
    td = tbody.getElementsByTagName("tr");

    for (i = 1; i < td.length; i++) { // Comenzamos desde 1 para omitir el primer elemento (campo de búsqueda)
        var id = td[i].querySelector(".title");
        var nombre = td[i].querySelector(".title1");
        var correo = td[i].querySelector(".title2");
        var telefono = td[i].querySelector(".title3");
        var direccion = td[i].querySelector(".title4");

        var searchText = nombre.innerText + " " + correo.innerText + " " + telefono.innerText + " " + direccion.innerText + " " + id.innerText;
        if (searchText.toUpperCase().indexOf(filter) > -1) {
            td[i].style.display = "";
        } else {
            td[i].style.display = "none";
        }
    }
}


$(document).ready(function() {
        
        $('.eliminar-proveedor').click(function() {
        var CodigoSP = $(this).data('idpro');
        console.log(CodigoSP)
        Swal.fire({
        title: '¿Estás seguro?',
        text: '¿Deseas eliminar el registro?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sí, eliminar',
        cancelButtonText: 'Cancelar'
        
      }).then((result) => {
       
        if (result.isConfirmed) {
            $('#ideli').val(CodigoSP);
            document.getElementById("deleteForm").submit();
    
        } else {
          console.log("Eliminación cancelada");
        }
        });
    
        });
    
            
    });
    
</script>


{% endblock %}