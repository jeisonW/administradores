{% extends "layout.html" %}

{% block title %}
    Empleados
{% endblock %}


{% block main %}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">
  

<style>
    /* Estilos del Navbar */
    .navbar1 {
      background-color: #f6f6f6;
      overflow: hidden;
    }
  
    .navbar1 a {
      float: right;
      color: rgb(0, 0, 0);
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
    }
  
    .navbar1 a:hover {
      color: rgb(255, 0, 0);
    }
  
    .navbar1 .left-content {
      float: left;
    }
  
   
  
  
    </style>
  <link rel="stylesheet" href="static/css/button.css">
  
  
  <section class="p-4 my-container">
    
    <div class="navbar1">
        <div class="left-content">
            <button  type="submit" class="btn prueba btn-primary mb-4" id="menu-btn">
                <i class="fas fa-bars"></i> Menú
            </button>
        </div>
        <a href="/logout"> 
                <i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesión
        </a>  
        {% if session["user_id"][0][1] == 'admin' %}
  
        <a href="/edituser"> Usuarios </a>
        {% endif %}
  
      </div>  
      
    <div class="form-group text-center">
        <input type="text" id="searchInput1" class="form-control mx-auto custom-border" onkeyup="filter()" placeholder="Buscar..." >
        <button type="button" class="btn btn-primary add-empleado" >
        Registrar nuevo Empleado
      </button>

    </div>
    <table class="table table-dark table-striped">
    <thead>
        <tr>
            <th scope="col">id</th>
            <th scope="col">Nombre</th>
            <th scope="col">Correo</th>
            <th scope="col">Telefono</th>
            <th scope="col">Direccion</th>
            <th scope="col">Salario Semanal</th>
            <th scope="col"></th>

            </tr>
            </thead>
            <tbody>
                {% for row in datos %}
                <tr class="dos">
                    <td class="title">{{row.IDempleado }}</td>
                    <td class="nombre">{{row.NombreEmpleado}}</td>
                    <td class="correo">{{row.Correo}}</td>
                    <td class="telefono">{{row.Telefono}}</td>
                    <td class="direc">{{row.Dirreccion}}</td>
                    <td class="salario">C$ {{row.salario}}</td>
                    <td>  
                      <a href="#" class="btn btn-primary btn-sm editar-empleado" data-IDempleado="{{row.IDempleado }}" data-NombreEmpleado="{{row.NombreEmpleado}}" data-Correo="{{row.Correo}}" data-Telefono="{{row.Telefono}}" data-Dirreccion="{{row.Dirreccion}}" data-Salario="{{row.salario}}"><i class="fas fa-pencil"></i></a>
                      <a  href="#" class="btn btn-danger btn-sm eliminar-empleado" data-CODIGOpc="{{row.IDempleado}}" ><i class="fa-solid fa-user-minus"></i></a></td>

                </tr>
                {% endfor %}
        </table>
            
    <!-- Ventana modal -->
    <form action="/editEmpleado" method="post"  enctype="multipart/form-data">
        <div id="editarModal" class="modal fade " tabindex="-1" role="dialog" aria-labelledby="editarModalLabel" aria-hidden="true">
            <div class="modal-dialog ">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editarModalLabel">Editar Empleado</h5>
                        <button type="button" class="close ocultar" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <div class="modal-body">
                        <input type="hidden" id="IDempleado" name="id">
                        <div class="form-group">
                            <label for="NombreEmpleado">Nombre</label>
                            <input type="text" class="form-control" id="NombreEmpleado" name="nombre" required  pattern="[a-zA-Z\s]+" title="No se aceptan datos numericos" >
                        </div>
                        <div class="form-group">
                            <label for="Correo">Correo </label>
                            <input type="email" class="form-control" id="Correo"  name="correo" pattern=".*gmail.com$" required>
                        </div>
                        <div class="form-group">
                            <label for="Telefono">Telefono</label>
                            <input type="number" class="form-control" id="Telefono" name="Telefono" min="0" minlength="8" title="Ingresa solo números y debe tener 8 dígitos" required pattern="[0-9]{8}" >
                        </div>
                        <div class="form-group">
                            <label for="Dirreccion">Dirección</label>
                            <input type="text" class="form-control" id="Dirreccion" name="Dirreccion" required>
                        </div>
                        <div class="form-group">
                            <label for="salario">salario</label>
                            <input type="number" class="form-control" id="salario" name="salario" min="1" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary guardar-cambios">Guardar</button>
                        <button type="button" class="btn btn-secondary ocultar" data-dismiss="modal">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <form action="/eliminarempleado" method="post" id="deleteForm">
        <input type="hidden" id="ideli" name="idhiddenform">    
        <input type="hidden" name="tabla" >
    </form>


    <div id="registrarmodal" class="modal fade " tabindex="-1" role="dialog" aria-labelledby="editarModalLabel" aria-hidden="true">
    <form action="/addempleado" method="post">
            <div class="modal-dialog ">
    <div class="modal-content">
        <div class="modal-header bg-dark text-primary">
          <h5 class="modal-title" id="editarModalLabel">Registrar Empleado</h5>
          <button type="button" class="close" style="color: #fff;" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      <div class="modal-body">
  
        <div class="form-group">
            <label class="form-label" for="nombre">Nombre del Empleado *:</label>
            <input class="form-input" type="text" id="nombre" name="nombre" placeholder="Nombre" required  pattern="[a-zA-Z\s]+" title="No se aceptan datos numericos" >
          </div>
    
          <div class="form-group">
            <label class="form-label" for="talla">Correo:</label>
            <input class="form-input" type="email" name="correo" placeholder="example@gmail.com" pattern=".*gmail.com$" required>
          </div>
          
          <div class="container">
            <div class="row">
                <div class="col-6 form-group">
                     <label class="form-label" for="color">Telefono :
                        <input type="text" class="form-input" name="telefono" min="0" minlength="8" title="Ingresa solo números y debe tener 8 dígitos" required pattern="[0-9]{8}" >
                    </label>
                </div>
                <div class="col-6 form-group">
                    <label class="form-label" for="color">Salario :
                        <input type="number" class="form-input" name="salario" placeholder="########"  min="1" required>
                    </label>
                </div>
                
            </div>
          </div>
         
          <div class="form-group">
              <label class="form-label" for="precio" > Direccion :
              <input class="form-input" type="text" name ="direccion" >
              </label>
          </div>
    
         
         
      </div>

      <div class="modal-footer">
        <button type="submit" class="btn btn-primary guardar-cambios">Guardar</button>
        <button type="button" class=" close btn btn-secondary " data-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</form>
    </div>
    

    
    
</section>

  
<script src="/static/js/navbar.js"></script>

<!--js bootstraps-->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<script>
    function filter() {
        var input, filter, tbody, td, i;
        input = document.getElementById("searchInput1");
        filter = input.value.toUpperCase();
        tbody = document.querySelector(".table");
        td = tbody.getElementsByTagName("tr");

        for (i = 1; i < td.length; i++) { // Comenzamos desde 1 para omitir el primer elemento (campo de búsqueda)
            var id = td[i].querySelector(".title");
            var nombre = td[i].querySelector(".nombre");
            var correo = td[i].querySelector(".correo");
            var telefono = td[i].querySelector(".telefono");
            var direccion = td[i].querySelector(".direc");
            var salario = td[i].querySelector(".salario")

            var searchText = nombre.innerText + " " + correo.innerText + " " + telefono.innerText + " " + direccion.innerText + " " + id.innerText + " " + salario.innerText;
            if (searchText.toUpperCase().indexOf(filter) > -1) {
                td[i].style.display = "";
            } else {
                td[i].style.display = "none";
            }
        }
    }

    $(document).ready(function() {
        
        $('.eliminar-empleado').click(function() {
        var CodigoSP = $(this).data('codigopc');
        console.log(CodigoSP)
        Swal.fire({
        title: '¿Estás seguro?',
        text: '¿Deseas eliminar el registro?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sí, eliminar',
        cancelButtonText: 'Cancelar'
        
      }).then((result) => {
       
        if (result.isConfirmed) {
        $('#ideli').val(CodigoSP);
        document.getElementById("deleteForm").submit();
         
        } else {
          console.log("Eliminación cancelada");
        }
        });
    
        });

    var message = "{{ mensaje }}";
    
    // Verifica si hay un mensaje de error y muestra la modal correspondiente
    if (message == 'Empleado Eliminado!') {
      Swal.fire({
        position: 'center',
        icon: 'success',
        title:message,
        showConfirmButton: false,
        timer: 2000
      })
    }

    var add_empleado = "{{ add_empleado }}";
    
    // Verifica si hay un mensaje de error y muestra la modal correspondiente
    if (add_empleado == 'Empleado Registrado!') {
      Swal.fire({
        position: 'center',
        icon: 'success',
        title:add_empleado,
        showConfirmButton: false,
        timer: 2000
      })
    }
            


    $('.add-empleado').click(function() {
     
     // Mostrar la ventana modal
     $('#registrarmodal').modal('show');
   });

   $('.close').click(function() {
     $('#registrarmodal').modal('hide');

   });
    });
    
</script>
<!--js propio-->
<script src="/static/js/datoEmpleado.js"></script>
{% endblock %}